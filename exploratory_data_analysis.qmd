---
title: "Homework 5"
author: "Nathan Honea"
format: html
editor_options: 
  chunk_output_type: console
---

# Task 1

## Read in Data and Modify


```{r}
library(tidyverse)

# use the code provided
d1 <- read.table("student+performance/student/student-mat.csv", sep = ";", header = TRUE)

d2 <- read.table("student+performance/student/student-por.csv", sep=";", header = TRUE)

d3 <- merge(d1, d2, by = c("school", "sex", "age", "address", "famsize", "Pstatus", "Medu", "Fedu", "Mjob", "Fjob", "reason", "nursery", "internet"))

print(nrow(d3)) # 382 students


# use tidyverse functions
mat_data <- read_csv2("student+performance/student/student-mat.csv")

por_data <- read_csv2("student+performance/student/student-por.csv")

combined_data_1 <- inner_join(mat_data, 
                            por_data, 
                            by = c("school", "sex", "age", "address", "famsize", "Pstatus", "Medu", "Fedu", "Mjob", "Fjob", "reason", "nursery", "internet"))
```

We get a warning when combining the data via `inner_join()` on only these variables, say there is an unexpected many-to-many relationship between our tibbles. 

```{r}
combined_data <- inner_join(mat_data, 
                            por_data, 
                            by = c("school", "sex", "age", "address", "famsize", "Pstatus", "Medu", "Fedu", "Mjob", "Fjob", "reason", "guardian", "traveltime", "studytime", "failures", "schoolsup", "famsup", "activities", "nursery", "higher", "internet", "romantic", "famrel", "freetime", "goout", "Dalc", "Walc", "health"))

print(nrow(combined_data)) 

# change the sex, studytime, romantic, and goout variables to factors using the mutate function in all of the data sets
mat_data <- mat_data |> 
  mutate(
    sex = factor(sex, levels = c("F", "M"), labels = c("Female", "Male")),
    studytime = factor(studytime, levels = c(1, 2, 3, 4), labels = c("<2 hours", "2-5 hours", "5-10 hours", ">10 hours")),
    romantic = factor(romantic, levels = c("no", "yes"), labels = c("No", "Yes")),
    goout = factor(goout, levels = c(1, 2, 3, 4, 5), labels = c("Very Low", "Low", "Medium", "High", "Very High"))
  )

por_data <- por_data |> 
  mutate(
    sex = factor(sex, levels = c("F", "M"), labels = c("Female", "Male")),
    studytime = factor(studytime, levels = c(1, 2, 3, 4), labels = c("<2 hours", "2-5 hours", "5-10 hours", ">10 hours")),
    romantic = factor(romantic, levels = c("no", "yes"), labels = c("No", "Yes")),
    goout = factor(goout, levels = c(1, 2, 3, 4, 5), labels = c("Very Low", "Low", "Medium", "High", "Very High"))
  )

combined_data <- combined_data |> 
  mutate(
    sex = factor(sex, levels = c("F", "M"), labels = c("Female", "Male")),
    studytime = factor(studytime, levels = c(1, 2, 3, 4), labels = c("<2 hours", "2-5 hours", "5-10 hours", ">10 hours")),
    romantic = factor(romantic, levels = c("no", "yes"), labels = c("No", "Yes")),
    goout = factor(goout, levels = c(1, 2, 3, 4, 5), labels = c("Very Low", "Low", "Medium", "High", "Very High"))
  )
```

# Task 2

## Summarize the Data (Very Basic EDA)

```{r}
# look at how the combined data is stored
combined_data
str(combined_data)

# look at the number of missing values in each variable of the combined data
colSums(is.na(combined_data))
```

There are no missing data values in our data set!

### Categorical Variables

#### One-Way Contingency Tables

```{r}
# create one-way contingency tables of the combined data based on the factor variables
# contingency table on sex variable
table(combined_data$sex)
```

Based on the table, 146 of the students in our data are male.

```{r}
# contingency table on studytime variable
table(combined_data$studytime)
```

Based on the table, 157 of the students in our data study between 2 and 5 hours per week.

```{r}
# contingency table on romantic variable
table(combined_data$romantic)
```

Based on the table, 99 of the students in our data are in a romantic relationship.

```{r}
# contingency table on goout variable
table(combined_data$goout)
```

Based on the table, 40 of the students in our data go out with friends a very high amount.

#### Two-Way Contingency Tables
```{r}
# create two-way contingency tables of the combined data based on the factor variables
# contingency table on sex and studytime variables
table(combined_data$sex, combined_data$studytime)
```

Based on the table, 42 of the students in our data are females who study 5 to 10 hours per week.

```{r}
# contingency table on sex and romantic variables
table(combined_data$sex, combined_data$romantic)
```

Based on the table, 105 of the students in our data are males who are not in a romantic relationship.

```{r}
# contingency table on sex and goout variables
table(combined_data$sex, combined_data$goout)
```

Based on the table, 39 of the students in our data are females who go out with their friends a high (but not very high) amount.

```{r}
# contingency table on studytime and romantic variables
table(combined_data$studytime, combined_data$romantic)
```

Based on the table, 22 of the students in our data are in romantic relationships and study 5 to 10 hours per week.

```{r}
# contingency table on studytime and goout variables
table(combined_data$studytime, combined_data$goout)
```

Based on the table, 41 of the students in our data go out with their friends a high (but not very high) amount and study 2 to 5 hours per week.

```{r}
# contingency table on romantic and goout variables
table(combined_data$romantic, combined_data$goout)
```

Based on the table, 29 of the students in our data are in a romantic relationship and go out with friends a low (but not very low) amount.

#### Three-Way Contingency Tables
```{r}
# create three-way contingency tables of the combined data based on the factor variables
# contingency table on sex, studytime, and romantic variables
table(combined_data$sex, combined_data$studytime, combined_data$romantic)
```

Based on the table, 27 of the students in our data are females who study 5 to 10 hours per week and are not in a romantic relationship.

```{r}
# contingency table on sex, studytime, and goout variables
table(combined_data$sex, combined_data$studytime, combined_data$goout)
```

Based on the table, 30 of the students in our data are females who study 2 to 5 hours per week and go out with friends a medium amount.

```{r}
# contingency table on sex, romantic, and goout variables
table(combined_data$sex, combined_data$romantic, combined_data$goout)
```

Based on the table, 33 of the students in our data are males who are not in a romantic relationship and go out with friends a medium amount.

```{r}
# contingency table on studytime, romantic, and goout variables
table(combined_data$studytime, combined_data$romantic, combined_data$goout)
```

Based on the table, 31 of the students in our data study 2 to 5 hours per week, are not in a romantic relationship, and go out with friends a high (but not very high) amount of the time.

#### Conditional Two-Way Tables

```{r}
# create a conditional two-way table by subsetting using filter and then table()
# table of sex and romantic variables conditioned on goout being at the "High" level
only_high_goout <- combined_data |> 
  filter(goout == "High")

table(only_high_goout$sex, only_high_goout$romantic)

# create a conditional two-way table by subsetting a three-way table
# create the same table as above
cond_two_way <- table(combined_data$sex, combined_data$romantic, combined_data$goout)
cond_two_way[, , "High"]
```

#### Two-Way Contingency Table with dplyr

```{r}
# create a two-way contingency table of the combined data on the sex and studytime variables using group_by() and summarize() from dplyr
combined_data |> 
  group_by(sex, studytime) |> 
  summarise(count = n()) |> 
  pivot_wider(names_from = studytime, values_from = count) # pivot_wider() makes the table look similar to the one created with the table() function
```

#### Stacked and Side-by-Side Bar Graphs
```{r}
# create a stacked bar plot based on sex and studytime
ggplot(data = combined_data, aes(x = studytime, fill = sex)) + 
  geom_bar() + 
  labs(x = "Study Time", 
       y = "Count",
       title = "Stacked Bar Graph",
       subtitle = "Of Portuguese Student Data Grouped by Study Time and Sex") + 
  scale_fill_discrete("Sex")


# create a side-by-side bar graph based on the same variables
ggplot(data = combined_data, aes(x = studytime, fill = sex)) + 
  geom_bar(position = "dodge") + 
  labs(x = "Study Time", 
       y = "Count",
       title = "Side-by-Side Bar Graph",
       subtitle = "Of Portuguese Student Data Grouped by Study Time and Sex") + 
  scale_fill_discrete("Sex")
```

### Numeric Variables

#### Find Measures of Center and Spread
```{r}
# find the mean and standard deviation of student's ages, G1 math and G3 math scores
combined_data |> 
  summarize(
    mean_age = mean(age),
    sd_age = sd(age),
    mean_G1_math = mean(G1.x),
    sd_G1_math = sd(G1.x),
    mean_G3_math = mean(G3.x),
    sd_G3_math = sd(G3.x)
)
```

The average score was higher on the first period math (G1) than on the final math grade (G3) in our data, although the final math grade varies more.

```{r}
# find the mean and standard deviation of student's ages, G1 math and G3 math scores, subsetting to only include students with more than 3 abscences in math
combined_data |> 
  filter(absences.x > 3) |> 
  summarize(
    mean_age = mean(age),
    sd_age = sd(age),
    mean_G1_math = mean(G1.x),
    sd_G1_math = sd(G1.x),
    mean_G3_math = mean(G3.x),
    sd_G3_math = sd(G3.x)
)
```

When only considering students who missed class more than 3 times, the average first period math grade is lower than the total (11.1 < 11.3), but the average final grade among students who missed more than three classes is actually higher than the class average (11.2 > 11.0). Without doing a formal hypothesis test, based on the standard deviations and small differences in the means, the differences are likely not statistically significant.

```{r}
# find the mean and standard deviation of student's ages, G1 math and G3 math scores across sex as a grouping variable
combined_data |> 
  group_by(sex) |> 
  summarize(
    mean_age = mean(age),
    sd_age = sd(age),
    mean_G1_math = mean(G1.x),
    sd_G1_math = sd(G1.x),
    mean_G3_math = mean(G3.x),
    sd_G3_math = sd(G3.x)
)
```

Grouping by age, it appears than male students do better on average than female students in math, both at the first period benchmark, and in the final grade.

```{r}
# find the mean and standard deviation of student's ages, G1 math and G3 math scores across sex and study time as a grouping variable
combined_data |> 
  group_by(sex, studytime) |> 
  summarize(
    mean_age = mean(age),
    sd_age = sd(age),
    mean_G1_math = mean(G1.x),
    sd_G1_math = sd(G1.x),
    mean_G3_math = mean(G3.x),
    sd_G3_math = sd(G3.x)
)
```

Grouping by both sex and study time, it seems as though  higher study times generally lead higher average course grades for both males and females, although there are some exceptions. For females, those who studied less than two hours had a slightly higher average math grades than those who studied 2-5 hours, both for the first period and the final grade (10.5 > 10.4 and 10.3 > 10.1). And for males, those who studied 5-10 hours had a higher grade on average than those who studied more than ten hours, both for the first period and the final grade (13.4 > 11.9 and 13.9 > 11.7)

#### Correlation Matrix

```{r}
# create a correlation matrix between all numeric variables
combined_data |> 
  select(age, absences.x, absences.y, G1.x, G1.y, G2.x, G2.y, G3.x, G3.y) |> 
  cor(use = "pairwise.complete.obs")
```

Based on the correlation matrix, age has a weak correlation with all other variables, absences in one class have a moderate correlation with absences in the other (0.5638), and the grades at every period of each class have a moderate to strong correlation with the other grade variables, with math grade variables (ones ending in .x) having strong positive correlations with other math grades and moderate positive correlations with Portuguese grades, and the vice versa is true.


#### Numeric Plots

```{r}
# create a histogram, kernel density, and boxplot for G3 Portuguese and the G3 math scores grouped by sex
# histograms
# Portuguese final grades across sex
ggplot(data = combined_data, aes(x = G1.y)) + 
  geom_histogram(aes(fill = sex)) + 
  labs(
    x = "Portuguese Final Grade",
    y = "Count", 
    title = "Histogram of Portuguese Class Final Grades",
    subtitle = "In Portuguese Student Data"
  ) + 
  scale_fill_discrete("Sex")
```

Based on the histogram, the most students had a final Portuguese grade between 10 and 15. The highest scoring student was a female. The lowest scoring student was also a female.

```{r}
# Math final grades across sex
ggplot(data = combined_data, aes(x = G1.x)) + 
  geom_histogram(aes(fill = sex)) + 
  labs(
    x = "Math Final Grade",
    y = "Count", 
    title = "Histogram of Math Class Final Grades",
    subtitle = "In Portuguese Student Data"
  ) + 
  scale_fill_discrete("Sex")
```

Based on the histogram, the most common final math grade for students was 10. The highest grades anyone got was 19 (out of 20), which it appears two males and one female achieved.

```{r}
# kernel densities
# Portuguese final grades across sex
ggplot(data = combined_data, aes(x = G1.y)) + 
  geom_density(aes(fill = sex), alpha = 0.5) + 
  labs(
    x = "Portuguese Final Grade",
    y = "Density", 
    title = "Kernel Densities of Portuguese Class Final Grades",
    subtitle = "In Portuguese Student Data"
  ) + 
  scale_fill_discrete("Sex")
```

Based on the kernel densities, it appears females had slightly better final grades in Portuguese than males on average, with the density curve of female scores centered slightly farther right than the center of males scores, and males having a larger left tail, indicating more low scores.

```{r}
# Math final grades across sex
ggplot(data = combined_data, aes(x = G1.x)) + 
  geom_density(aes(fill = sex), alpha = 0.5) + 
  labs(
    x = "Math Final Grade",
    y = "Density", 
    title = "Kernel Densities of Math Class Final Grades",
    subtitle = "In Portuguese Student Data"
  ) + 
  scale_fill_discrete("Sex")
```

Based on the kernel densities, it appears there were more male students among the highest scoring the class for math, and the right tail of the distribution for males is larger than the distribution for females, indicating more high scoring males.

```{r}
# box plots
# Portuguese final grades across sex
ggplot(data = combined_data, aes(x = sex, y = G3.y, fill = sex)) + 
  geom_boxplot() + 
  geom_jitter(width = 0.2, alpha = 0.5) + 
  labs(
    x = "Sex",
    y = "Portuguese Exam Score", 
    title = "Box Plots of Portuguese Class Final Grades",
    subtitle = "In Portuguese Student Data"
  ) + 
  scale_fill_discrete("Sex")
```

Based on the side-by-side box plots, the median female had a slightly higher final grade in Portuguese than the median male. There also appear to be more very low performing males, with what appears to be eight males with a final grade of five or lower, and only two such females.

```{r}
# Math final grades across sex
ggplot(data = combined_data, aes(x = sex, y = G3.x, fill = sex)) + 
  geom_boxplot() + 
  geom_jitter(width = 0.2, alpha = 0.5) + 
  labs(
    x = "Sex",
    y = "Math Exam Score", 
    title = "Box Plots of Math Class Final Grades",
    subtitle = "In Portuguese Student Data"
  ) + 
  scale_fill_discrete("Sex")
```

Based on the side-by-side box plots, the median male final grade in math is slightly higher than the median final grade for females. There also appear to be more females who had a final grade of 0 than males.

```{r}
# scatterplots
# create a scatter plot relating the G3 math scores to the ages of students
ggplot(data = combined_data, aes(x = age, y = G3.x, color = sex)) + 
  geom_jitter(width = 0.2) + # use jitter so you can see all the points
  labs(
    x = "Age",
    y = "Math Class Final Gradee", 
    title = "Scatterplot of Students' Age and Math Class Final Grade",
    subtitle = "Grouped by Sex of the Student", 
    color = "Sex"
  )
```

There is no clear relationship between the age of students and their final math grade, as all age groups appear to have a similar distribution. There appears to be only one 22 year old, who significantly older than the next oldest students at 19 years old.

```{r}
# create a scatter plot relating the G3 math scores to the G1 math scores of students
ggplot(data = combined_data, aes(x = G1.x, y = G3.x, color = sex)) + 
  geom_jitter(width = 0.2) + # use jitter so you can see all the points
  labs(
    x = "Math Class First Period Grade",
    y = "Math Class Final Grade", 
    title = "Scatterplot of Math Class First Period and Final Grades",
    subtitle = "Grouped by Sex of the Student", 
    color = "Sex"
  )
```

There is a strong positive trend in this scatter plot indicating that a high first period math grade is strongly correlated to a high final math grade. There appear to be a few scores of 0 for the final grade but none for the first period grade, indicating some people may have not completed the course.

```{r}
# scatter plots with faceting (same as the scatterplots above but faceted on the studytime variable)
ggplot(data = combined_data, aes(x = age, y = G3.x, color = sex)) + 
  geom_jitter(width = 0.2) + # use jitter so you can see all the points
  labs(
    x = "Age",
    y = "Math Class Final Grade", 
    title = "Scatterplot of Students' Age and Math Class Final Grade",
    subtitle = "Grouped by Sex and Study Time of the Student", 
    color = "Sex"
  ) + 
  facet_wrap(~ studytime)
```

It appears that younger students may study be more likely to study five hours or less, as the majority of points for students ages 15-17 appear to be in either the <2 hours or 2-5 hours level of study time.

```{r}
ggplot(data = combined_data, aes(x = G1.x, y = G3.x, color = sex)) + 
  geom_jitter(width = 0.2) + # use jitter so you can see all the points
  labs(
    x = "Math Class First Period Grade",
    y = "Math Class Final Grade", 
    title = "Scatterplot of Math Class First Period and Final Grades",
    subtitle = "Grouped by Sex and Study Time of the Student", 
    color = "Sex"
  ) + 
  facet_wrap(~ studytime)
```

It appears that regardless of study time, a higher first period math grade is positively correlated with a higher final math grade.

```{r}
# scatter plots with another level of faceting
ggplot(data = combined_data, aes(x = age, y = G3.x, color = sex)) + 
  geom_jitter(width = 0.2) + # use jitter so you can see all the points
  labs(
    x = "Age",
    y = "Math Class Final Grade", 
    title = "Scatterplot of Students' Age and G3 Math Exam Score",
    subtitle = "Grouped by Sex, Study Time and Romantic Status of the Student", 
    color = "Sex"
  ) + 
  facet_grid(studytime ~ romantic)
```

Based on the grouped scatter plot, older students are more likely to have a romantic partner than younger students.

```{r}
ggplot(data = combined_data, aes(x = G1.x, y = G3.x, color = sex)) + 
  geom_jitter(width = 0.2) + # use jitter so you can see all the points
  labs(
    x = "Math Class First Period Grade",
    y = "Math Class Final Grade", 
    title = "Scatterplot of Math Class First Period and Final Grades",
    subtitle = "Grouped by Sex, Study Time and Romantic Status of the Student", 
    color = "Sex"
  ) + 
  facet_grid(studytime ~ romantic)
```

Across all grouped of sex, relationship status, and study time per week, a higher first period math grade is positively correlated with a higher final math grade.